!function(){"use strict";const t=document.currentScript,e=t?.getAttribute("data-shop-token")||"";e||console.error("[Looksy] Missing data-shop-token attribute on script tag");const n={iframeId:"virtual-fitting-iframe",buttonClass:"virtual-fitting-button",overlayClass:"virtual-fitting-overlay",productSelector:"[data-fitting-product]",imageSelector:"img[data-fitting-image]",nameAttribute:"data-fitting-name",priceAttribute:"data-fitting-price",widgetUrl:"https://test-widget.looksy.tech",iconUrl:"https://s3.regru.cloud/test-looksy/try_on_icon.png",buttonText:"Примерить на себе",zIndex:999999,shopToken:e};function i(){try{return new URL(n.widgetUrl).origin}catch(t){return n.widgetUrl.replace(/\/$/,"")}}let o=null,a=null,r=null;function s(){if(document.getElementById("virtual-fitting-styles"))return;const t=document.createElement("style");t.id="virtual-fitting-styles",t.textContent=`\n      .${n.buttonClass} {\n        position: absolute;\n        right: 8px;\n        bottom: 8px;\n        display: inline-flex;\n        align-items: center;\n        justify-content: center;\n        padding: 8px 8px;\n        background: #323232;\n        height: 37px;\n        color: #fff;\n        border: none;\n        border-radius: 7px;\n        font-size: 14px;\n        font-weight: 500;\n        cursor: pointer;\n        transition: opacity 0.2s ease;\n        font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n        -webkit-font-smoothing: antialiased;\n        -moz-osx-font-smoothing: grayscale;\n      }\n      .${n.buttonClass}:hover {\n        opacity: 90%;\n      }\n      .${n.buttonClass} img {\n        width: 16px;\n        height: 16px;\n        margin-right: 4px;\n        flex-shrink: 0;\n      }\n      .${n.overlayClass} {\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: rgba(0, 0, 0, 0);\n        z-index: ${n.zIndex};\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        visibility: hidden;\n        transition: background 0.15s ease, visibility 0.15s ease;\n      }\n      .${n.overlayClass}.active {\n        background: rgba(0, 0, 0, 0.5);\n        visibility: visible;\n      }\n      .${n.overlayClass}.active_processing {\n        background: rgba(0, 0, 0, 0.8);\n        visibility: visible;\n      }\n      #${n.iframeId} {\n        width: 100%;\n        max-width: 700px;\n        height: 90vh;\n        max-height: 800px;\n        border: none;\n        border-radius: 12px;\n        background-color: transparent;\n        opacity: 0;\n        transform: scale(0.95);\n        transition: opacity 0.2s ease, transform 0.2s ease, height 0.2s ease;\n      }\n      .${n.overlayClass}.active #${n.iframeId} {\n        opacity: 1;\n        transform: scale(1);\n      }\n      @media (max-width: 768px) {\n        .${n.overlayClass} {\n          align-items: flex-end;\n          justify-content: center;\n        }\n        #${n.iframeId} {\n          max-width: 100%;\n          width: 100%;\n          height: 95vh;\n          height: 95dvh;\n          max-height: none;\n          border-radius: 20px 20px 0 0;\n          opacity: 1;\n          transform: translateY(100%);\n          transition: transform 0.3s cubic-bezier(0.32, 0.72, 0, 1);\n        }\n        .${n.overlayClass}.active #${n.iframeId} {\n          transform: translateY(0);\n        }\n      }\n    `,document.head.appendChild(t)}function c(t){t.target===a&&m()}function l(){if(o)return o;o=document.createElement("iframe"),o.id=n.iframeId,o.setAttribute("sandbox","allow-same-origin allow-scripts allow-forms allow-popups allow-modals allow-downloads"),o.setAttribute("allow","camera; microphone; web-share");return(a||(a=document.createElement("div"),a.className=n.overlayClass,a.addEventListener("click",c),document.body.appendChild(a),a)).appendChild(o),o}function d(t){if(!o||!o.contentWindow)return;const e=i();o.contentWindow.postMessage(t,e)}function u(t){r=t;const e=l(),i=new URLSearchParams({embedded:"true",shopToken:n.shopToken,product:encodeURIComponent(JSON.stringify({image:t.image,name:t.name,price:t.price}))}),o=n.widgetUrl.replace(/\/$/,"");e.src=`${o}/?${i.toString()}`,requestAnimationFrame(()=>{requestAnimationFrame(()=>{a.classList.add("active"),document.body.style.overflow="hidden"})})}function m(){a&&(a.classList.remove("active"),a.classList.remove("active_processing"),document.body.style.overflow=""),setTimeout(()=>{o&&(o.src="about:blank")},150),r=null}function p(t){if(t.querySelector(`.${n.buttonClass}`))return;const e=document.createElement("button");e.className=n.buttonClass,e.type="button";const i=document.createElement("img");i.src=n.iconUrl,i.alt="",i.setAttribute("aria-hidden","true"),e.appendChild(i);const o=document.createTextNode(n.buttonText);e.appendChild(o),e.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation();const i=function(t){const e=t.querySelector(n.imageSelector);if(!e)return console.warn("Virtual Fitting: Image not found in product element"),null;const i=e.src||e.getAttribute("data-src"),o=t.getAttribute(n.nameAttribute)||e.getAttribute("alt")||"Product",a=t.getAttribute(n.priceAttribute)||"";return i?{image:i,name:o,price:a}:(console.warn("Virtual Fitting: Image source not found"),null)}(t);console.log("productData :>> ",i),i&&u(i)});const a=t.querySelector(n.imageSelector);a&&a.parentNode?(console.log("imageElement.nextSibling :>> ",a.nextSibling),a.parentNode.insertBefore(e,a.nextSibling)):t.appendChild(e)}function g(){const t=document.querySelectorAll(n.productSelector);t.forEach(t=>{p(t)}),console.log(`Virtual Fitting: Initialized ${t.length} buttons`)}function f(){const t=i();window.addEventListener("message",e=>{if(e.origin!==t)return;const{type:n,data:i}=e.data;switch(n){case"CLOSE_WIDGET":m();break;case"WIDGET_READY":case"REQUEST_PRODUCT":r&&d({type:"PRODUCT_DATA",product:r});break;case"PROCESSING":a.classList.add("active_processing"),a.removeEventListener("click",c);break;case"GENERATION_READY":a.classList.remove("active_processing"),a.addEventListener("click",c)}})}function b(){new MutationObserver(t=>{t.forEach(t=>{t.addedNodes.forEach(t=>{if(1===t.nodeType){t.matches&&t.matches(n.productSelector)&&p(t);const e=t.querySelectorAll&&t.querySelectorAll(n.productSelector);e&&e.forEach(t=>p(t))}})})}).observe(document.body,{childList:!0,subtree:!0})}window.VirtualFitting={open:u,close:m,init:g},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{s(),g(),f(),b()}):(s(),g(),f(),b())}();